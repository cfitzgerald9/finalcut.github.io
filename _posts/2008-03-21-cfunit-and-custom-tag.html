---
layout: post
title: "CFUnit and a Custom Tag"
date: 2008-03-21
comments: false
categories:
 - customtags
 - coldfusion
 - test driven development
 - unit testing
 - cfunit
 - tdd
---

<div class='post'>
I'm not spending much time working in ColdFusion right now. However, on occasion I need to go back and do a little maintenance on a legacy product.&nbsp; One of those had a pretty poorly written (by me) custom tag for figuring out the number of days in the month.&nbsp; This is a custom tag that has been in use since 2000 and yet the bug with it wasn't noticed until this month.&nbsp; It should have been noticed back in 2004 but it wasn't.&nbsp; Heck it would have been noticed when I wrote it if it had some unit tests associated with it.&nbsp; But it didn't so this month the customer came back upset that a report wasn't showing the right numbers because the data for the 29 of Feb. wasn't being shown.<br /><br />Ok, so it was a stupid bug but those are the ones that slip by so easily if you don't have unit tests in place.&nbsp; Fortunately, we now have nice frameworks like CFUnit that make writing unit tests easy.&nbsp; However, I didn't really see any good documentation on writing tests for custom tags so this brief article is designed to show one simple example:<br /><br />Just like with the rest of the CFUnit examples you need two files a CFC which contains the tests and a cfm page that invokes those tests.  I'm just going to show you the CFC with the tests since invoking them is the same as every other CFUnit test.<br /><br /><pre name="code" class="coldfusion"><br />&lt;cfcomponent name="LastDayInMonth" extends="net.sourceforge.cfunit.framework.TestCase"&gt;<br /> &lt;cffunction name="setUp" returntype="void" access="public"&gt;<br />  &lt;cfimport taglib="/aemis/CustomTags/StandardCustomTags" prefix="standard" /&gt;<br /> &lt;/cffunction&gt;<br /><br /><br /> &lt;cffunction name="testFebruaryInLeapYear" returntype="void" access="public"&gt;<br />  &lt;cfset var output="" /&gt;<br />  <br />  &lt;standard:Days_In_Month month_id="2" year="2008" returnvariable="output"&gt;<br /><br />  &lt;cfinvoke method="assertEquals"&gt;<br />   &lt;cfinvokeargument name="expected" value="29" /&gt;<br />   &lt;cfinvokeargument name="actual" value="#output#" /&gt;<br />  &lt;/cfinvoke&gt;<br />   <br /> &lt;/cffunction&gt;<br /><br /> &lt;cffunction name="testThirtyOneDayMonth" returntype="void" access="public"&gt;<br />  &lt;cfset var output="" /&gt;<br />  <br />  &lt;standard:Days_In_Month month_id="5" year="2008" returnvariable="output"&gt;<br /><br />  &lt;cfinvoke method="assertEquals"&gt;<br />   &lt;cfinvokeargument name="expected" value="31" /&gt;<br />   &lt;cfinvokeargument name="actual" value="#output#" /&gt;<br />  &lt;/cfinvoke&gt;<br />   <br /> &lt;/cffunction&gt;<br /><br /> &lt;cffunction name="testThirtyDayMonth" returntype="void" access="public"&gt;<br />  &lt;cfset var output="" /&gt;<br />  <br />  &lt;standard:Days_In_Month month_id="4" year="2008" returnvariable="output"&gt;<br /><br />  &lt;cfinvoke method="assertEquals"&gt;<br />   &lt;cfinvokeargument name="expected" value="30" /&gt;<br />   &lt;cfinvokeargument name="actual" value="#output#" /&gt;<br />  &lt;/cfinvoke&gt;<br />   <br /> &lt;/cffunction&gt;<br /><br /> &lt;cffunction name="testFebruaryInNonLeapYear" returntype="void" access="public"&gt;<br />  &lt;cfset var output="" /&gt;<br /><br />  &lt;standard:Days_In_Month month_id="2" year="2007" returnvariable="output"&gt;<br /><br />  &lt;cfinvoke method="assertEquals"&gt;<br />   &lt;cfinvokeargument name="expected" value="28" /&gt;<br />   &lt;cfinvokeargument name="actual" value="#output#" /&gt;<br />  &lt;/cfinvoke&gt;<br />   <br /> &lt;/cffunction&gt;<br /><br /> &lt;cffunction name="testLastMonthOfYear" returntype="void" access="public"&gt;<br />  &lt;cfset var output="" /&gt;<br /><br />  &lt;standard:Days_In_Month month_id="12" year="2008" returnvariable="output"&gt;<br /><br />  &lt;cfinvoke method="assertEquals"&gt;<br />   &lt;cfinvokeargument name="expected" value="31" /&gt;<br />   &lt;cfinvokeargument name="actual" value="#output#" /&gt;<br />  &lt;/cfinvoke&gt;<br />   <br /> &lt;/cffunction&gt;<br /><br /><br />&lt;/cfcomponent&gt;<br /><br /></pre><br /><br />This is pretty straight forward based on the code I think.  I basically just import the customtag library using the setUp method and then test the specific tag I'm interested in here.  Now this custom tag just happens to have a returnVariable.  However, your custom tag might just output stuff directly.  If that is the case use the &lt;cfsavecontent&gt; tag to capture the output and then run your assertions against the output like so<br /> <br /><pre name="code" class="coldfusion"><br /><br /> &lt;cffunction name="testPrintLastMonthOfYear" returntype="void" access="public"&gt;<br />  &lt;cfset var output="" /&gt;<br /><br />  &lt;cfsavecontent variable="output&gt;<br />  &lt;standard:Print_Days_In_Month month_id="12" year="2008"&gt;<br />  &lt;/cfsavecontent&gt;<br />  &lt;cfinvoke method="assertEquals"&gt;<br />   &lt;cfinvokeargument name="expected" value="31" /&gt;<br />   &lt;cfinvokeargument name="actual" value="#output#" /&gt;<br />  &lt;/cfinvoke&gt;<br />   <br /> &lt;/cffunction&gt;<br /></pre></div>
<h2>Comments</h2>
<div class='comments'>
<div class='comment'>
<div class='author'>jones</div>
<div class='content'>
Nice blog...<BR/>visit also <A HREF="http://coldfusion-example.blogspot.com/" REL="nofollow"><B>coldfusion example</B></A></div>
</div>
</div>
