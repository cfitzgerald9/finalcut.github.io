---
layout: post
title: "Adding discreet amount to a Date (C# example)"
date: 2007-09-03
comments: false
categories:
 - .net
 - datetime
 - c#
 - utility
---

<div class='post'>
<p>In my last post I talked about getting the number of years, months, and days between two dates.  Today I'll show how to go the other way, take a date and add years months and days to it to get a date.</p><br /><p>The only assumption here is that you are passing in a relDate string in a format like so: "1y 2m 3d" or any subset of that such as "1y 3d" or "2m 3d" or even just "1y" or "3d" etc.</p><br /><p><br />The Microsoft DateTime object has a nice AddYears, AddMonths, and AddDays method but there is a little catch to using them. You have to add from smallest to largest date unit. If you do it the other way around you will get inconsistent results. Here is some sample code that also includes some examples of inconsistent results if you add in the wrong order.  NOTE: these examples use a "RelativeDateTimeException" which is a custom class I wrote - you should provide your own exception handling.<br /></p><br /><pre name="code" class="csharp"><br />        public static int ParseRelativeDateToNumDays(string relDate, DateTime refDate, int maxRange)<br />        {<br />            int invalidDayCode = -99999;<br />            int numDays = invalidDayCode;<br />            DateTime baseDate = refDate;<br /><br />            if (relDate != null)<br />            {<br />                try<br />                {<br />                    string stringToParse = relDate.Trim();<br />                    if (stringToParse.Length > 0)<br />                    {<br />                        string pattern = @"^-?((\d+)\s*y)?\s*((\d+)\s*m)?\s*((\d+)\s*d)*$";<br />                        Match match = Regex.Match(stringToParse, pattern);<br /><br />                        Group yearGroup = match.Groups[2];<br />                        Group monthGroup = match.Groups[4];<br />                        Group dayGroup = match.Groups[6];<br /><br /><br />                        if (yearGroup.Success || monthGroup.Success || dayGroup.Success)<br />                        {<br />                            int yearPart = yearGroup.Success ? Int32.Parse(yearGroup.Value) : 0;<br />                            int monthPart = monthGroup.Success ? Int32.Parse(monthGroup.Value) : 0;<br />                            int dayPart = dayGroup.Success ? Int32.Parse(dayGroup.Value) : 0;<br /><br />                            if (stringToParse.ToCharArray()[0] == '-')<br />                            {<br />                                yearPart = -yearPart;<br />                                monthPart = -monthPart;<br />                                dayPart = -dayPart;<br />                            }<br /><br />                            /* the larger units need to be added first or else<br />                            * the result will be different (and wrong) since we are<br />                            * trying to get the number of days from refDate and not refDate+days..<br />                            * for instance lets say the refDate = 31 Aug 2007 and you wanted to add<br />                             * in the order: days, months, years the answer for the following scenarios<br />                             * would be:<br />                             * 1.  +6m = 29 Feb 2008<br />                             * 2.  +5m 29d = 29 Feb 2008 (feb has 29 days in 2008 leap year and all)<br />                             * 3.  +5m 30d = 29 Feb 2008 (what?  well Sep 30 2007 + 5m = feb 29 2008)<br />                             * <br />                             * now if you added in years, months, days..<br />                            *  1.  +6m = 29 Feb 2008<br />                             * 2.  +5m 29d = 29 Feb 2008<br />                             * 3.  +5m 30d = 01 Mar 2008<br />                             * <br />                             * Ah, but what happens then, in this case if we are adding 1 year + 6m?<br />                             *  if we add in days, months, years:<br />                             * 1. +ly 6m = 28 Feb 2008<br />                             * 2. +1y 5m 28d = 28 Feb 2008<br />                             * 3. +1y 5m 29d = 28 Mar 2008 (wrong again)<br />                             *<br />                             * *  if we add in years, months, days:<br />                             * 1. +ly 6m = 28 Feb 2008<br />                             * 2. +1y 5m 28d = 28 Feb 2008<br />                             * 3. +1y 5m 29d = 01 Mar 2008<br />                            */<br />                            refDate = refDate.AddYears(yearPart);<br />                            refDate = refDate.AddMonths(monthPart);<br />                            refDate = refDate.AddDays(dayPart);<br /><br /><br />                            numDays = (int)DateAndTime.DateDiff(DateInterval.Day, baseDate, refDate);<br /><br />                            if (stringToParse.ToCharArray()[0] == '-')<br />                            {<br />                                //numDays = -numDays;<br />                            }<br /><br />                        }<br />                        else<br />                        {<br />                            int tDays = 0;<br />                            if (int.TryParse(stringToParse, out tDays))<br />                            {<br />                                // we curently have numDays months (default on entry is months if no specifier<br />                                refDate = refDate.AddMonths(tDays);<br />                                numDays = (int)DateAndTime.DateDiff(DateInterval.Day, DateTime.Now, refDate);<br />                            }<br /><br />                        }<br />                    }<br />                }<br />                catch(Exception e)<br />                {<br />                    throw new RelativeDateException(RelativeDateException.ExceptionType.OutOfBoundsException, e.InnerException, "");<br />                }<br />            }<br /><br />            if (numDays == invalidDayCode)<br />            {<br />                throw new RelativeDateException(RelativeDateException.ExceptionType.InvalidFormatException, null, "");<br />            }<br />            else if (numDays > Math.Abs(maxRange))<br />            {<br />                throw new RelativeDateException(RelativeDateException.ExceptionType.OutOfMaxRangeException, null, "");<br />            }<br /><br />            return numDays;<br />        }<br /></pre></div>
