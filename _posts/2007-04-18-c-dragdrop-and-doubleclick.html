---
layout: post
title: "C# - DragDrop and DoubleClick"
date: 2007-04-18
comments: false
categories:
 - doubleclick
 - dragdrop
 - c#
---

<div class='post'>
I was working on a simple custom control today that displays thumbnails.  The thumbnail ordering can be changed by dragging/dropping and you can double click a thumbnail to have a full version of the image pop up in a new dialog.  Pretty simple - or is it?<br /><br />It turns out that the DragDrop functionality is turned on for an object during the MouseDown event.  However, when you double click the MouseDown event is also fired and thus the app thinks you are dragging after the first click and the DoubleClick event won't get fired.  What's a coder to do?<br /><br />I looked all over for an idea and the best anyone could suggest was combining MouseDown (set a flag) with MouseMove (start DragDrop if flag is set) to start the DragDrop.  This doesn't work too well though if you do a mouseup outside the app (and then drag the mouse back in in the up or down state).<br /><br />It turns out though that there is a easy and pretty clean solution.  The MouseDown event passes along a collection of MouseEventArgs. One of those values is "Clicks" that tells you how many times the mouse was clicked.  The event gets called once for a click and again for a double click.  So when you double click it calls MouseDown twice.  The first time it "enter drag mode" but as soon as you raise the button to click the second time it exits drag mode.  The second mousedown has a "Clicks" value of 2 and you can avoid going into drag mode and thus the DoubleClick will be fired.<br /><br /><pre name="code" class="csharp"><br />   void pictureBox_MouseDown(object sender, MouseEventArgs e)<br />   {<br />    if (e.Button == MouseButtons.Left && e.Clicks ==1)<br />    {<br />     PictureBox pb = (PictureBox)sender;<br />     DoDragDrop((ImageData)pb.Tag, DragDropEffects.Copy);<br />    }<br />   }<br /><br /></pre><br /><br />In the prior example I only want to enter Drag mode if the left button is clicked AND it was only clicked one time. I couldn't find this information anywhere else so hopefully this post will help someone.</div>
<h2>Comments</h2>
<div class='comments'>
<div class='comment'>
<div class='author'>Anonymous</div>
<div class='content'>
Thanks, concise and to the point.<br />Saved me some time suckage!</div>
</div>
<div class='comment'>
<div class='author'>Anonymous</div>
<div class='content'>
Let&#39;s see .. it&#39;s 2:01 CST August 20, 2012 WAY in the future. <br />Thanks. Looking forward to your next big thing. </div>
</div>
<div class='comment'>
<div class='author'>Little</div>
<div class='content'>
It works perfectly.  Thanks!</div>
</div>
<div class='comment'>
<div class='author'>Anonymous</div>
<div class='content'>
Many thanks!!</div>
</div>
<div class='comment'>
<div class='author'>Anonymous</div>
<div class='content'>
THC! Even better than THX!</div>
</div>
<div class='comment'>
<div class='author'>Crazistor</div>
<div class='content'>
I had to port my application from Lazarus to C# and you saved me a lot of time with this nice solution. Many thanks!</div>
</div>
<div class='comment'>
<div class='author'>Crazistor</div>
<div class='content'>
I had to port my application from Lazarus to C# and you saved me a lot of time with this nice solution. Many thanks!</div>
</div>
<div class='comment'>
<div class='author'>Eric Enright</div>
<div class='content'>
Thank you for taking the time to post this snippet.  It is exactly the solution I was looking for.</div>
</div>
<div class='comment'>
<div class='author'>Anonymous</div>
<div class='content'>
This saved me some time also. Thanks</div>
</div>
<div class='comment'>
<div class='author'>Anonymous</div>
<div class='content'>
4.5 years later, folks are still thanking you for posting this.  I guess you hit that nail on the head, huh?  :)<br /><br />Duncan<br /><br />PS:  thanking you for posting this!</div>
</div>
<div class='comment'>
<div class='author'>Anonymous</div>
<div class='content'>
Thanks, just what I needed. :D</div>
</div>
<div class='comment'>
<div class='author'>Anonymous</div>
<div class='content'>
Thanks a lot - this one was really bothering me... :-/</div>
</div>
<div class='comment'>
<div class='author'>Anonymous</div>
<div class='content'>
SUPER tip !!!<br /><br />Thanks,<br />Eddy.</div>
</div>
<div class='comment'>
<div class='author'>Anonymous</div>
<div class='content'>
Thanks ! Really :)</div>
</div>
<div class='comment'>
<div class='author'>Anonymous</div>
<div class='content'>
easy and works thx</div>
</div>
<div class='comment'>
<div class='author'>Paul Buisman</div>
<div class='content'>
Thank you. Solved the problem for me too :-)</div>
</div>
<div class='comment'>
<div class='author'>Anonymous</div>
<div class='content'>
thank you !</div>
</div>
<div class='comment'>
<div class='author'>Anonymous</div>
<div class='content'>
Again - thanks. One comment. If for any reason it doesn&#39;t work haev a look to ensure that the clickable item is set as AllowDrop. I needed to do this otherwise a double click would treat the item as being dropped onto itself and funny things happened if it wasn&#39;t itself set as AllowDrop.</div>
</div>
<div class='comment'>
<div class='author'>Bill</div>
<div class='content'>
To all the thanks - You&#39;re welcome.  Glad to help!</div>
</div>
<div class='comment'>
<div class='author'>Ali Koyuncu</div>
<div class='content'>
Thank you, dude. You savde my day.</div>
</div>
<div class='comment'>
<div class='author'>Anonymous</div>
<div class='content'>
Just what I needed !</div>
</div>
<div class='comment'>
<div class='author'>Anonymous</div>
<div class='content'>
<b>Excelente! Gracias!</b></div>
</div>
<div class='comment'>
<div class='author'>chuvahin</div>
<div class='content'>
Thanks. Very helpful</div>
</div>
<div class='comment'>
<div class='author'>heringer</div>
<div class='content'>
Thanks!</div>
</div>
<div class='comment'>
<div class='author'>LambyPie66</div>
<div class='content'>
Just what I needed and a great explanation - thankyou</div>
</div>
<div class='comment'>
<div class='author'>sbetberg</div>
<div class='content'>
Thank You</div>
</div>
<div class='comment'>
<div class='author'>sbetberg</div>
<div class='content'>
Thanks</div>
</div>
<div class='comment'>
<div class='author'>sbetberg</div>
<div class='content'>
Thank You</div>
</div>
<div class='comment'>
<div class='author'>steve</div>
<div class='content'>
Works great. Just had this problem today. ty</div>
</div>
<div class='comment'>
<div class='author'>Mike</div>
<div class='content'>
Thanks for the help with this.  Unfortunately I still couldn't get it to work in my TreeView.  In fact, it even stopped triple-clicking from invoking the ItemDoubleClick event, which had worked in the past. Maybe I have a strange combination of other things also interfering like AfterSelect events and so on.<br /><br />For anyone having similar problems to me, though, I did find <A HREF="http://social.msdn.microsoft.com/forums/en-US/winforms/thread/0b756636-0acb-4972-9fb8-00627cb9f764/" REL="nofollow">another workaround</A> where someone has suggested making the DoDragDrop() call from the .ItemDrag() event instead of from the MouseDown() event.  Perhaps this just ensures the user is actually trying to drag it beforehand, or something like that.<br /><br />It seems to work perfectly for me, at least.</div>
</div>
<div class='comment'>
<div class='author'>Anonymous</div>
<div class='content'>
thanks :)</div>
</div>
<div class='comment'>
<div class='author'>Anonymous</div>
<div class='content'>
Sometimes it's the little things in life that mean a lot ....<BR/><BR/>Thank you!</div>
</div>
<div class='comment'>
<div class='author'>Anonymous</div>
<div class='content'>
Thanks a lot!!!!</div>
</div>
<div class='comment'>
<div class='author'>jabbot</div>
<div class='content'>
Wow, you are a life saver. Ever so simple to think about it. You've saved me hours!</div>
</div>
<div class='comment'>
<div class='author'>Anonymous</div>
<div class='content'>
Very nice and elegant solution that works :-)</div>
</div>
<div class='comment'>
<div class='author'>Anonymous</div>
<div class='content'>
Top stuff. Thanks!</div>
</div>
<div class='comment'>
<div class='author'>Anonymous</div>
<div class='content'>
Looked Everywhere for this.  Worked like a charm!  Thanks!</div>
</div>
<div class='comment'>
<div class='author'>Dima</div>
<div class='content'>
1) Thanks for the post!<BR/><BR/>2) Anonimous - Mouse DoubleClick fires 2 events - one with Clicks==1 and one with Cliks==2.<BR/>if you put a break point in MouseDown event, then VS2008 will jump on the first click and second will never happen.<BR/>Try to set a breakpoint with Condition "e.Clicks == 2".</div>
</div>
<div class='comment'>
<div class='author'>Bill</div>
<div class='content'>
I have no idea. I still use VS 2005 and have not had a chance to try out any code in VS 2008.<BR/><BR/>It seems unlikely that the drag and drop and double click behavior would change so much but it is possible.</div>
</div>
<div class='comment'>
<div class='author'>Anonymous</div>
<div class='content'>
This doesn't work for me. I'm using Visual Studio 2008, and every time I double-click, the MouseDown event always fires with a Clicks == 1. <BR/><BR/>Could it be that this behavior has changed with VS2008?</div>
</div>
<div class='comment'>
<div class='author'>Anonymous</div>
<div class='content'>
thanks!!!!</div>
</div>
<div class='comment'>
<div class='author'>alexz</div>
<div class='content'>
Nice solution, thanks!</div>
</div>
<div class='comment'>
<div class='author'>Richard Potter</div>
<div class='content'>
Was worried about this - thanks for such an elegant solution</div>
</div>
<div class='comment'>
<div class='author'>Andreea</div>
<div class='content'>
Thank you so much !!</div>
</div>
<div class='comment'>
<div class='author'>Anonymous</div>
<div class='content'>
Thanks this is great..Keep up the good work!!</div>
</div>
<div class='comment'>
<div class='author'>james</div>
<div class='content'>
Thanks, solved a big headache!</div>
</div>
<div class='comment'>
<div class='author'>Anonymous</div>
<div class='content'>
Thanks!</div>
</div>
<div class='comment'>
<div class='author'>Anonymous</div>
<div class='content'>
Perfect, fast, complete solution to my exact problem. Lots of time saved</div>
</div>
<div class='comment'>
<div class='author'>Anonymous</div>
<div class='content'>
Brilliant idea!</div>
</div>
<div class='comment'>
<div class='author'>Anonymous</div>
<div class='content'>
Great work.  Thanks.</div>
</div>
<div class='comment'>
<div class='author'>Anonymous</div>
<div class='content'>
Great !!</div>
</div>
<div class='comment'>
<div class='author'>Anonymous</div>
<div class='content'>
Many thanks!  I had the same problem, this worked perfectly.</div>
</div>
<div class='comment'>
<div class='author'>Anonymous</div>
<div class='content'>
Thanks!!</div>
</div>
<div class='comment'>
<div class='author'>Mike Lasseter</div>
<div class='content'>
thanks.  this saved my some time googling</div>
</div>
</div>
