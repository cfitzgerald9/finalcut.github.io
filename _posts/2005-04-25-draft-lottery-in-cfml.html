---
layout: post
title: "Draft Lottery in CFML"
date: 2005-04-25
comments: false
categories:
 - coldfusion
 - draft
 - lottery
---

<div class='post'>
In the spirit of the recent NFL draft and the upcoming NFL Fantasy Football season my league is preparing for an expansion draft. Draft order is determined based on a format similar to the NBA's lottery where each team gets some "n" number of entries in the lottery based on their past performance and new expansion teams get 3+ Max(n) to give them a slight advantage in the drawing.<br /><br />Instead of tearing up a bunch of paper, putting it in a hat, and then doing a manual drawing I decided to throw together some very quick procedural code that will enable this. I'm sure there are better ways to accomplish it, but this is what jumped out of my head first and I didn't really give it much thought beyond that.<br /><br />Basically, it is up to the user to define a structure of teams and their number of tokens. The code then does a bunch of randomization and gives you a draft order based on the total number of teams in the lottery. Finally, it displays that draft order as an ordered list. Pretty simple eh? I borrowed a function from cflib and totally revamped another for my needs. Both are given credit in the very sparse comments in the following code.<br /><br /><br /><pre name="code" class="jscript"><br />&lt;cfscript&gt;<br /><br />/* SETUP<br /> add each team to the team structure and assign them a number of lottery entries<br /> obviously, each team name must be unique<br />*/<br /><br /><br /> teams = structNew();<br /><br /> /* add old teams here */<br /> teams.nate = 1;<br /> teams.mike = 2;<br /> teams.bill = 3;<br /> teams.beth = 4;<br /> teams.drew = 5;<br /><br /><br /> newTeamTokens = structCount(teams) + 3;<br /><br /> /* add new teams here */<br /> teams.ed = newTeamTokens;<br /> teams.dan = newTeamTokens;<br /><br /><br /><br /><br /><br />/* DO NOT EDIT BELOW THIS LINE */<br /><br />function ListRandomElements(theList, numElements) {<br />/**<br /> * Returns specified number of random list elements without repeats.<br /> * <br /> * @param theList   Delimited list of values. (Required)<br /> * @param numElements   Number of list elements to retrieve. (Required)<br /> * @param theDelim   Delimiter used to separate list elements.  The default is the comma. (Optional)<br /> * @return Returns a string. <br /> * @author Shawn Seley (shawnse@aol.com) <br /> * @version 1, July 10, 2002 <br /> */<br /> var theDelim     = ",";<br /> var final_list   = "";<br /> var x            = 0;<br /> var random_i     = 0;<br /> var random_val   = 0;<br /><br /> var theArray = "";<br /><br /> if(ArrayLen(Arguments) GTE 3) theDelim = Arguments[3];<br /><br /> theArray = listToArray(theList,theDelim);<br /><br /> if(numElements GT ArrayLen(theArray)) {<br />  numElements = ArrayLen(theArray);<br /> }<br /><br /> randomize(TimeFormat(Now(),"mmss"));<br /> <br /> // Build the new list "scratching off" the randomly selected elements from the original list in order to avoid repeats<br /> for(x=1; x LTE numElements; x=x+1){<br />  random_i        = RandRange(1, ArrayLen(theArray));    // pick a random list element index from the remaining elements<br />  random_val      = theArray[random_i];      // get the corresponding list element's value<br />  theList         = ArrayDeleteAt(theArray, random_i);   // delete the used element from the list<br /><br />  final_list      = ListAppend(final_list, random_val , theDelim);<br /> }<br /><br /> return(final_list);<br />}<br /><br />function ListRemoveItem(list1,item) {<br />/**<br /> * Removes all instances ofa  specific item from a list<br /> * <br /> * @param list1  Delimited list of values. (Required)<br /> * @param item   item to remove from the list<br /> * @param theDelim   Delimiter used to separate list elements.  The default is the comma. (Optional)<br /> * @return Returns a string. <br /> * @author Bill Rawlinson - based on ListRemoveList by Ann Terrell (ann@landuseoregon.com) <br /> * @version 1, April 25, 2005<br /> */<br />  var listReturn = list1;<br />  var position = 1;<br />  var theDelim = ",";<br /> if(ArrayLen(Arguments) GT 2) theDelim = Arguments[3];<br /><br /> while (ListFindNoCase(listReturn, item, theDelim) NEQ 0) {<br />  listReturn = ListDeleteAt(listReturn, ListFindNoCase(listReturn, item, theDelim), theDelim);<br /> }<br />  <br />  return listReturn;<br />}<br />&lt;/cfscript&gt;<br /><br />&lt;cffunction name="getDraftPool" returnType="string"&gt;<br /> &lt;cfargument name="teamList" type="string"&gt;<br /> &lt;cfset var theDraftPool = ""&gt;<br /> &lt;cfset var tokens = 0&gt;<br /> &lt;cfset var thisTeam = ""&gt;<br /><br /><br /> &lt;cfloop list="#arguments.teamList#" index="thisTeam"&gt;<br />  &lt;cfset tokens = teams[thisTeam]&gt;<br />  &lt;cfloop from="1" to="#tokens#" index="someteam"&gt;<br />   &lt;cfset theDraftPool = listAppend(theDraftPool,thisTeam)&gt;<br />  &lt;/cfloop&gt;<br /> &lt;/cfloop&gt;<br /><br /> &lt;cfreturn ListRandomElements(theDraftPool,listLen(theDraftPool)) /&gt;<br />&lt;/cffunction&gt;<br /><br />&lt;cffunction name="getPick" returntype="string"&gt;<br /> &lt;cfargument name="pool"  type="string"&gt;<br /> &lt;cfset var pickedteam = ""&gt;<br /> &lt;cfset var theIndex = 0&gt;<br /><br /> &lt;cfif listLen(arguments.pool)&gt;<br /><br />  &lt;cfset randomize(TimeFormat(Now(),"mmss"))&gt;<br />  &lt;cfset theIndex = RandRange(1,listLen(arguments.pool))&gt;<br />  &lt;cfset pickedTeam = listGetAt(arguments.pool,theIndex) &gt;<br /> &lt;/cfif&gt;<br /> <br /> &lt;cfreturn pickedTeam /&gt;<br /><br />&lt;/cffunction&gt;<br /><br /><br /><br />&lt;cffunction name="runLottery" returntype="string"&gt;<br /> &lt;cfset var teamNames =  structKeyList(teams)&gt;<br /> &lt;cfset var overallDraftPool = getDraftPool(teamNames)&gt;<br /> &lt;cfset var pickedTeam = ""&gt;<br /> &lt;cfset var thisTeam = ""&gt;<br /> &lt;cfset var lotteryResults = ""&gt;<br /><br /> &lt;cfsavecontent variable="lotteryResults"&gt;<br /> &lt;cfoutput&gt;<br /> &lt;ol&gt;<br />  &lt;cfloop list="#teamNames#" index="thisTeam"&gt;<br />   &lt;li&gt;<br />   &lt;cfset pickedTeam = getPick(overallDraftPool)&gt;<br /><br />   #pickedTeam#<br /><br />   &lt;cfset teamNames = ListRemoveItem(teamNames,pickedTeam)&gt;<br />   &lt;cfset overallDraftPool  = getDraftPool(teamNames)&gt;<br />   &lt;cfif ListLen(teamNames) EQ 0&gt;<br />    &lt;cfbreak /&gt;<br />   &lt;/cfif&gt;<br />   &lt;/li&gt;<br />  &lt;/cfloop&gt;<br /> &lt;/ol&gt;<br /> &lt;/cfoutput&gt;<br /><br /> &lt;/cfsavecontent&gt;<br /><br /><br /> &lt;cfreturn lotteryResults /&gt;<br /><br />&lt;/cffunction&gt;<br /><br /><br /><br />&lt;cfset results = runLottery()&gt;<br />&lt;cfoutput&gt;#results#&lt;/cfoutput&gt;<br /></pre></div>
