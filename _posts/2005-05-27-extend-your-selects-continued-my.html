---
layout: post
title: "Extend Your Selects Continued (My Mistakes)"
date: 2005-05-27
comments: false
categories:
 - javascript
---

<div class='post'>
Well, it seems I stepped in a pile of something.  First, I have to come clean with the facts.  Before today the methods I showed earlier for extending a SELECT box were just functions that took in the select box and the other properties.  However, I decided to rewrite them as methods of the select box object.  It works in Mozilla; but alas not IE.<br /><br />Some of the methods I showed earlier needed to be rewritten anyway as they were neither efficient or practical and at least one was just reinventing the wheel.<br /><br />First let me reiterate these will only work in Mozilla. I'm not sure why they work in Mozilla at all since it sounds like they shouldn't work at all according to the spec - but that is a debate for others to worry about.  I can extend the STRING and the ARRAY objects just fine across browsers but not the HTMLSelectElement.  <br /><br />Anyway, first we need to just dump the new method I wrote earlier called HTMLSelectElement.prototype.dropOption as it is already a built in method called remove:<br /><br /><pre name="code" class="jscript"><br /> objSel.remove(4);<br /></pre><br /><br />Secondly the insert, prepend, and append methods were all pretty poorly done.  So I just dropped the prepend, and append and rewrote insert.<br /><br /><pre name="code" class="jscript"><br />HTMLSelectElement.prototype.insertOption = function(id,textValue,position){<br /> var newOpt = new Option(textValue,id);<br /> <br /> if(!isNaN(position) && position &lt; this.length-1 && position &gt;= 0) {<br />  this.add(newOpt,this.options[position]);<br /> } else {<br />  this.add(newOpt,null);<br /> }<br />}<br /></pre><br /><br />Now if I want to prepend I can just call the above with position of 0, to append I don't pass in a position, and to insert I pass in any numeric value.  If the value is not numeric, too small, or too big it just appends the new option.<br /><br />You might also notice I'm now using the built in method "add" instead of AppendChild.  Add is basically the same as my insertOption except it handles the creation of the new OPTION object.<br /><br />I discovered my IE mistake by trying to run my test page in IE easilly enough.  After some google research it seems it just isn't possible.  I also discovered my other mistakes by, now hold on here, reading the SPEC.  That's right by reading the DOM spec at the W3C page I was able to learn how stupid I am!  You can see the spec for the HTMLSelectElement if you want.<br /><br />Here is the full library of updated methods (plus a couple extra). I'm not sure how useful they are as is since they don't work in IE.  But they should be easy to transform back to functions if you need one.<br /><br /><pre name="code" class="jscript"><br />// removes all options from the select box<br />HTMLSelectElement.prototype.clear = function(){<br /> while (this.length &gt; 0) {<br />  this.remove(0);<br /> }<br />}<br /><br />// changes the selection to a specified position<br />HTMLSelectElement.prototype.select = function(position){<br /> if(position &gt; this.length-1) position = this.length-1;<br /><br /> this.selectedIndex = position;<br />}<br /><br /><br />// changes the selection to a specific id<br />HTMLSelectElement.prototype.selectID = function(id){<br /> var idx = 0;<br /> for (idx=0;idx&lt;this.length;idx++){<br />  if(this.options[idx].value == id){<br />   this.select(idx);<br />   break;<br />  }<br /> }<br />}<br /><br />// changes the selection to a specific text value<br />HTMLSelectElement.prototype.selectElementByText = function(textValue){<br /> var idx = 0;<br /> for (idx=0;idx&lt;this.length;idx++){<br />  if(this.options[idx].text == textValue){<br />   this.select(idx);<br />   break;<br />  }<br /> }<br />}<br /><br /><br />// changes the selection to a specific text value<br />HTMLSelectElement.prototype.textValue = function(){<br /> return this.options[selectedIndex].text;<br />}<br /><br /><br /><br />// clears a select box and optionaly inserts a first object<br />HTMLSelectElement.prototype.init = function(id,textValue){<br /> this.clear();<br /> if(textValue){<br />  this.options[0] = new Option(textValue,id);<br /> }<br />}<br /><br /><br />HTMLSelectElement.prototype.insertOption = function(id,textValue,position){<br /> var newOpt = new Option(textValue,id);<br /> <br /> if(!isNaN(position) && position &lt; this.length-1 && position &gt;= 0) {<br />  this.add(newOpt,this.options[position]);<br /> } else {<br />  this.add(newOpt,null);<br /> }<br />}<br /></pre></div>
<h2>Comments</h2>
<div class='comments'>
<div class='comment'>
<div class='author'>Anonymous</div>
<div class='content'>
fwiw it seems that you can attach methods to instances of HTMLSelectElement in IE. Not nearly as convenient as attaching to the prototype, but it may help you out in some situations.<BR/><BR/>cheers,<BR/><BR/>mathieu</div>
</div>
</div>
