---
layout: post
title: "Installing CF8 and CF9 side by side on Apache 2.x"
date: 2011-02-18
comments: false
categories:
 - coldfusion
 - jrun
 - cf8
 - cf9
---

<div class='post'>
I have a bit of a conundrum; I have some clients who use CF8 some who use CF9 (and yes, some who still use CF 6 and 7).  However, for the most part I only have to do regular work for those clients who use either CF8 or CF9.  The trouble is I only have one development machine and I need to have both CF8 and CF9 installed in parallel in such a way that I can easily switch between the two servers when I switch project contexts.  The following will explain how I set this up on my Windows XP machine and it borrows heavily from <a href="http://www.cfgothchic.com/blog/post.cfm/presentation-installing-multiple-versions-of-coldfusion-together">a presentation I found at CF Goth Chic's website</a>.<br /><br />Before you begin I suggest you just uninstall any copy of CF you already have setup. &nbsp;Before I did that I created a Coldfusion Archive that contained all of my existing datasources and mappings so I could quickly replicate them later. &nbsp;If you don't know how to create or deploy a coldfusion archive I suggest you check the CF documentation. &nbsp;Even without it you can probably guess your way though the process. &nbsp;I only included the datasources and mappings in mine but you may want to back even more stuff up.<br /><br /><br />Ok, now on to the meat of the operation:<br /><br /><br /><ol><li>Install Coldfusion 9 first. &nbsp;You want to begin with the newest version so that you have the latest version of the Java Runtime to work with.</li><ol><li>As you install you'll want to pick "Enterprise Multiserver Configuration"</li><li>Also make sure you select "Use Built In Webserver, Development Only"</li></ol><li>Once the install has completed let the installer open the "Configuration Wizard"</li><li>Once the Configuration Wizard finishes open the CF Administrator for your install at&nbsp;<a href="http://127.0.0.1:8300/CFIDE/administrator/index.cfm">http://127.0.0.1:8300/CFIDE/administrator/index.cfm</a></li><li>Inside the CF Admin Expand the "Enterprise Manager" option in the left menu and select Instance Manager</li><li>Create a New Instance</li><ol><li>Server Name: CF9</li><li>Server Directory will auto-populate</li><li>Select "Create Windows Service"</li><li>Deselect "Auto Start Service"</li><li>Click Submit - this part will take a while; sit back and browse <a href="http://www.reddit.com/">Reddit </a>or something while you wait.</li></ol><li>Once the setup was done you can visit the CF Admin for your new instance at http://127.0.0.1:8301/CFIDE/administrator &nbsp;once here you can deploy your Coldfusion Archive if you created one.</li><li>Install Coldfusion 8</li><ol><li>This is a little more tricky. &nbsp;Pick the J2EE configuration &nbsp;"EAR" file</li><li>Enter the context root of /</li><li>Use the default for every other option; if you deviate from the defaults make a note of your changes and apply them as necessary in the later steps.</li><ol><li>I provided the same admin and rds passwords I used in the CF9 installation.</li></ol></ol><li>Go back to the CF9 admin at&nbsp;<a href="http://127.0.0.1:8300/CFIDE/administrator/index.cfm">http://127.0.0.1:8300/CFIDE/administrator/index.cfm</a>&nbsp;and define a second instance under the "Enterprise Manager"</li><ol><li>ServerName: CF8</li><li>Server Directory will auto-populate</li><li>Create for EAR/WAR (optional) - enter the path to your newly created EAR file (C:\Coldfusion8\cfusion.ear is the default)</li><li>Select "Create Windows Service"</li><li>Deselect "Auto Start Service"</li><li>Click submit - again this will take a while - read the news at <a href="http://newsvine.com/">newsvine</a> and relax.</li></ol><li>Once this step is done you can vist the CF Admin for this instance at http://127.0.0.1:8302/cfide/administrator</li><li>At this point you're just about done. &nbsp;We just have to make some apache configuration changes. &nbsp;So first off go to /JRUN4/bin/wsconfig.exe and setup either your cf8 or cf9 server with your apache install. &nbsp;This will do a couple things. &nbsp;1. It will put the default jrun statements in your apache conf file and it will setup the jrun apache module under /jrun4/lib/wsconfig/1/ </li><li>next in /jrun4/lib/wsconfig create two directories &nbsp; one called cf9 and the other cf8</li><li>now go to your apache conf file and search for JRUN and you'll find something like this<br /><br /><pre class="xml" name="code">&lt;IfModule mod_jrun20.c&gt;<br />    JRunConfig Verbose false<br />    JRunConfig Ignoresuffixmap false<br />    #JRunConfig Errorurl url &lt;optionally redirect to this URL on errors&gt;<br />    #JRunConfig ProxyRetryInterval 600 &lt;number of seconds to wait before trying to reconnect to unreachable clustered server&gt;<br />    #JRunConfig ConnectTimeout 15 &lt;number of seconds to wait on a socket connect to a jrun server&gt;<br />    #JRunConfig RecvTimeout 300 &lt;number of seconds to wait on a socket receive to a jrun server&gt;<br />    #JRunConfig SendTimeout 15 &lt;number of seconds to wait on a socket send to a jrun server&gt;<br /><br /> JRunConfig Apialloc false<br /> JRunConfig Serverstore "C:/dev/tools/JRun4/lib/wsconfig/cf9/jrunserver.store"<br /> JRunConfig Bootstrap 127.0.0.1:51000<br /> AddHandler jrun-handler .jsp .jws .cfm .cfml .cfc .cfr .cfswf<br />&lt;/IfModule&gt;<br /></pre><br />I've actually edited it a little to make those last four lines stand out.    The 51000 is the port that CF9's proxy is listening on.  Basically that is how APACHE talks to JRUN and CF9.  If you have a virtual server setup that you want to use your CF8 install you'd just put the following code inside your virtual server node of the conf file:<br /><pre class="xml" name="code">&lt;IfModule mod_jrun20.c&gt;<br /> JRunConfig Apialloc false<br /> JRunConfig Serverstore "C:/dev/tools/JRun4/lib/wsconfig/cf8/jrunserver.store"<br /> JRunConfig Bootstrap 127.0.0.1:51002<br /> AddHandler jrun-handler .jsp .jws .cfm .cfml .cfc .cfr .cfswf<br />&lt;/IfModule&gt;<br /></pre><br />Note that both the serverstore was updated to point to /cf8/...  and the BootStrap port was switched to 51002.<br /></li></ol><br />NOTE:  If you try to hit a site that is configured for CF8 at this point and it fails with the following error messages in your site.log:<br /><pre>Couldn't initialize from remote server, JRun server(s) probably down.<br />  JRun will not accept request.  Check JRun web server configuration and JRun mappings on JRun server.<br /></pre>You'll want to check the following things.  <br /><br /><ol><li>First look in your /jrun4/servers/cf8/server-inf/jrun.xml file down near line 377 and make sure the deactivated value is "false".  It probably is.&nbsp;</li><li>&nbsp;You'll then want to go to the JRUN management console at http://localhost:8000 - login with your cfadmin username and password.</li><li>Expand the cf8 server node in the left menu and then click on "services" in the right panel you should see "ProxyService" and the status will probably say "Initialized" &nbsp;That's the problem, it needs to say "Running"</li><li>Click on the "Play" icon under "Actions" beside ProxyService.. Once that starts you should be able to load your CF8 site without any problems.</li></ol></div>
