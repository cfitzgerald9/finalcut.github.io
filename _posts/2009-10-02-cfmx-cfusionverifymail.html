---
layout: post
title: "CFMX CFUSION_VERIFYMAIL"
date: 2009-10-02
comments: false
categories:
 - coldfusion
 - smtp
---

<div class='post'>
This isn't really a feature I've needed much but I thought it might be useful to share if anyone else ever needs it.<br /><br />Basically, a long time ago, Coldfusion had <a href="http://www.houseoffusion.com/cfdocs1/cf45/Administering_ColdFusion_Server/10_Configuring_Advanced_Security/admin1018.htm">a little secret function</a> called CFUSION_VERIFYMAIL which was used to verify the smtp server was available to CF.  Once ColdFusion became ColdFusion MX that function went away and I never thought about it again.<br /><br />Well, today I wanted to do something very similar but I wasn't sure what to do so I searched for my old hidden function and <a href="http://www.mail-archive.com/cf-talk@houseoffusion.com/msg98345.html">found a forum thread</a> that offered the basics of a solution.  Well technically it is the solution but it just wasn't as complete as I wanted it so I fluffed it just a touch and now I offer to you as a resource should you need it.<br /><br /><br /><pre name="code" class="coldfusion"><br />&lt;cffunction name="mailServerIsUp" returntype="boolean" access="public"&gt;<br /> &lt;cfargument name="smtp_server" type="string" default="" /&gt;<br /> &lt;cfargument name="smtp_port" type="numeric" default="0" /&gt;<br /> &lt;cfargument name="timeout"  type="numeric" default="10" /&gt;<br /> &lt;cfargument name="service"  type="any" default='#createObject("java", "coldfusion.server.ServiceFactory")#' /&gt;<br /><br /> &lt;cfset arguments.service = arguments.service.getMailSpoolService() /&gt;<br /><br /> <br /> &lt;cfif LEN(arguments.smtp_server)&gt;<br />  &lt;cfset arguments.service.setServer(arguments.smtp_server) /&gt;<br /> &lt;/cfif&gt;<br /> &lt;cfif VAL(arguments.smtp_port)&gt;<br />  &lt;cfset arguments.service.setPort(VAL(arguments.smtp_port)) /&gt;<br /> &lt;/cfif&gt;<br /><br /> &lt;cfset arguments.service.setTimeout(VAL(arguments.timeout)) /&gt;<br /><br /> &lt;cfreturn arguments.service.verifyServer() /&gt;<br />&lt;/cffunction&gt;<br /></pre><br /><br />I've tried to make the function fairly flexible (in case you already keep a copy of the service factory in your application scope or something plus I wanted to make sure you could point at your own applications mailserver/port if you need to OR it will just use the default server settings.<br /><br />Finally, I had to change the name of the function becuase CF was throwing an error if I tried to call that old hidden functions name.  Plus, I think verifymailserver is more clear than just verifymail.  I just left the cfusion_ on the front as a hat tip to the original.<br /><br />Obviously this can be improved by adding some exception handling - especially in regards to determining if the arguments.service passed in is the correct object type; but I'll leave that to others.</div>
