---
layout: post
title: "Build Dynamic Breadcrumbs"
date: 2005-02-25
comments: false
categories:
 - coldfusion
 - breadcrumbs
---

<div class='post'>
I posted about this before but today I did a rewrite which I think is a bit cleaner. It is safe to use on CF 5 and above. I suppose it would work on 4.5 but I don't have that installed anymore and haven't tested it. Nor do I remember if wddx was supported in pre CF 5.<br /><br />I have seen other "breadcrumb" solutions before but they deal with directory structure and don't necessarilly maintain all of the arguments that need to be passed around in order to make each page in your traversal history work. This solution does.<br /><br />A couple of notes before I dig into the code:<br />1. It requires client variables are enabled. Now, you could switch this with session variables if you want but I use client variables. Replace as you need to.<br />2. It uses WDDX to store the entire breadcrumb structure in a client variable.<br /><br />There are a couple of things that are done kind of poorly as well - feel free to comment on those if you want. Maybe you will see some things that I didn't.<br /><br />The setup uses three files - but really it can be reduced to two. The third file just contains a simple UDF that I had written previously and since I already need it elsewhere in the application I keep it in it's own "functions" file.<br /><br /><br />I'll start with the functions.cfm file and it's sole applicable function for this process: "ArrayLeft()". This takes in an array and a count 'x' and returns a trimmed version of the array down to length 'x'.<br /><br /><pre name="code" class="coldfusion"><br />function ArrayLeft(array,numElements){<br />  var tArray= ArrayNew(1);<br />  if (numElements gte arrayLen(array)){<br />    return array;<br />  }<br />  for (i=1; i LTE numElements; i=i+1){<br />    tArray[i] = array[i];<br />  }<br /><br />  return tArray;<br />}<br /></pre><br /><br />The second file is where alot of the good stuff happens. I called it build_url_string.cfm and I call it as a custom tag. I keep this file in the same directory as the other two instead of putting it off in the "Custom Tag" directory.<br /><br />Sorry, no syntax highlighting available and indention is lost by this blog editor - but here is the file<br />===================================================================<br />// build_url_string.cfm<br />===================================================================<br /><pre name="code" class="coldfusion"><br />&lt;!--- build_url_string.cfm - Copyright (c) 2005 SBCS, Inc. ---&gt;<br /> &lt;!--- build_url_string.cfm - Copyright (c) 2005 SBCS, Inc. ---&gt;<br /><br /> &lt;!---<br />  Description:<br />   I build a structure that contains all the information needed to build a hypertext link to the current page.<br />  Parameters:<br />   @param pageVariable if you use a "switch" type mechanism and everything runs through index.cfm - then what<br />         is the name of the variable you switch on: ie: index.cfm?page=thisPage or index.cfm?fuseaction=go<br />         the pagevariables would be page and fuseaction respectively.<br /><br />   @param pageCaption  the name of the current page.  Basically the title or what ever it is you want displayed in<br />         the breadcrumb trail for this page.<br /><br />   @param ignoreAttrs  a comma delmited list of attribute keys to ignore.  As attribues is a structure, you just provide<br />         a list of keys to not include in the breadcrumb URL.<br />   <br />   @param returnVariable the variable you want populated.  This tag returns a structure of the form:<br />         struct<br />          struct.link - the base url with the first "pageVariable" if one exists<br />          struct.text - the text you want displayed.  Basically just a copy of pageCaption<br />          struct.args - a string of argumnents to append to the link.<br /><br />          so if you wanted to display this link you would:<br /><br />          &lt;cfoutput&gt;&lt;a href="#struct.link#"&gt;#struct.link##struct.args#&lt;/a&gt;&lt;/cfoutput&gt;<br /><br />         you don't have to figure out if a ? or a & goes between url and arguments as it <br />         is built into the struct.args value that is returned<br /><br />         the link and the argument are separated for a reason as it provides the most flexibility<br />         for any calling file.<br /><br />  Usage:<br /><br />   &lt;cf_build_url_string<br />    attributeCollection="#attributes#"<br />    pageVariable        ="page"<br />    pageCaption   ="Home Page"<br />    ignoreAttrs   ="comma,delmited,list,of,attributes,to,ignore"<br />    returnVariable  ="urlInfo"&gt;<br /><br /><br />  Revision History:<br />   2/25/2005 wmrawlin this header block finally added after a complete rewrite.<br /><br /> ---&gt;<br /> &lt;cfparam name="attributes.pageCaption" type="string" default=""&gt;<br /> &lt;cfparam name="attributes.pageVariable" type="string" default=""&gt;<br /> &lt;cfparam name="attributes.ignoreAttrs" type="string" default=""&gt;<br /> <br /><br /> &lt;!--- define our return structure ---&gt;<br /> &lt;cfset urlInfo = structNew()&gt;<br /> &lt;cfset urlInfo.link = ListGetAT(cgi.script_name,ListLen(cgi.script_name,"/"),"/")&gt;<br /> &lt;cfset urlInfo.text = attributes.pageCaption&gt;<br /> &lt;cfset urlInfo.args = ""&gt;<br /><br /> &lt;!--- make sure the current pageVariable is ignored ---&gt;<br /> &lt;cfset attributes.ignoreAttrs = ListAppend(attributes.ignoreAttrs,attributes.pageVariable)&gt; <br /><br /> &lt;!--- make sure some special attributes are ignored ---&gt;<br /> &lt;cfset attributes.ignoreAttrs = ListAppend(attributes.ignoreAttrs,"ignoreAttrs,pageCaption,attributeCollection,pageVariable,returnVariable")&gt;<br /><br /> &lt;!--- <br />  try to figure out what arguments were passed in via<br />  form and url or arguments<br /> ---&gt;<br /> &lt;cfloop List="#StructKeyList(attributes)#" Index="thisKey"&gt;<br />  &lt;cfif NOT ListFindNoCase(attributes.ignoreAttrs,thisKey) AND Len(attributes[thisKey])&gt;<br />   &lt;cfset urlInfo.args = ListAppend(urlInfo.args,"#thisKey#=#attributes[thisKey]#","&amp;")&gt;<br />  &lt;/cfif&gt;<br /> &lt;/cfloop&gt;<br /><br /> &lt;!--- prepend with an & or an ? for the first element ---&gt;<br /> &lt;cfif len(urlInfo.args) and len(attributes.pageVariable)&gt;<br />  &lt;cfset thisKey = attributes.pageVariable&gt;<br />  &lt;cfset urlInfo.args  = "?#thisKey#=" & attributes[thisKey] & "&" & urlInfo.args&gt;<br /> &lt;cfelseif len(urlInfo.args)&gt;<br />  &lt;cfset urlInfo.args = "?#urlInfo.args#"&gt;<br /> &lt;/cfif&gt;<br /><br />&lt;cfset "caller.#attributes.returnVariable#" = urlInfo&gt;<br /></pre><br />===================================================================<br />// end build_url_string.cfm<br />===================================================================<br /><br />That file returns a nice struture of the current pages URL. I use both of these prior files in the next, and final file, to generate and draw a nice dynamic breadcrumb.<br /><br />===================================================================<br />// dsp.breadcrumb.cfm<br />===================================================================<br /><pre name="code" class="coldfusion"><br />&lt;cfsilent&gt;<br /> &lt;!--- dsp.breadcrumb.cfm - Copyright (c) 2005 SBCS, Inc. ---&gt;<br /><br /> &lt;!---<br />  Description:<br />   I maintain and build a dynamic breadcrumb trail (showing each page a user has visited).<br /><br />   NOTE: All URL and FORM variables should be moved into the Attribute scope before calling this file.<br />   there are plenty of existing examples of code available to accomplish this. By convention we typically<br />   call said method in our application.cfm file.<br /><br />   <br />  Parameters:<br />   NONE; just must be included in the context of your site where the URL and FORM scope are still<br />   available.  These variables will be in the attributes scope by now - but this rule is important or<br />   else you might lose many important attributes, unless you always passon attributesCollection to each<br />   level of your page/circuit.<br />   <br />  Usage:<br />   &lt;cfinclude template="dsp.breadcrumb.cfm"&gt;<br /><br />  Revision History:<br />   2/25/2005 wmrawlin this header block finally added after a complete rewrite.<br /><br /> ---&gt;<br /> <br /> &lt;cfinclude template="functions.cfm"&gt;<br /><br /> &lt;cfset breadCrumb = ArrayNew(1)&gt;<br /><br /> &lt;!--- this is the title of your sites root page.  we need to know this ---&gt;<br /> &lt;cfset homePageText = "ListBuilder Home"&gt;<br /><br /><br /> &lt;!--- we store the breadcrumb structure as a WDDX packet in the client.breadcrumb variable ---&gt;<br /> &lt;cfif NOT isDefined("client.breadcrumb") OR NOT isWddx(client.breadcrumb)&gt;<br />  &lt;cfwddx action="cfml2wddx" input="#breadcrumb#" output="client.breadcrumb"&gt;<br /> &lt;/cfif&gt;<br /><br /><br /> &lt;!--- at this point we need to grab the existing breadcrumb info into a local variable ---&gt;<br /> &lt;cfwddx action="wddx2cfml" input="#client.breadcrumb#" output="breadcrumb"&gt;<br /><br /><br /> &lt;!--- if we are at the root page of the site, reset the trail ---&gt;<br /> &lt;cfif attributes.page EQ homePageText&gt;<br />  &lt;cfset breadCrumb = ArrayNew(1)&gt;<br /> &lt;/cfif&gt;<br /><br /> &lt;!--- i pass "password" in as an ignoreAttr to be on the safe side for security concerns ---&gt;<br /> &lt;cf_build_url_string<br />  attributeCollection ="#attributes#"<br />  pageVariable  ="page"<br />  ignoreAttrs   ="password"<br />  returnVariable="urlInfo"&gt;<br /><br /><br /><br /><br /> &lt;!--- now determine if this linkText exists in the trail - if so we need<br /> to trim the trail down to this point ---&gt;<br /> &lt;cfset thisPageEntryIndex = 0&gt;<br /><br /> &lt;cfloop from="1" to="#ArrayLen(breadCrumb)#" index="bi"&gt;<br />  &lt;cfif breadCrumb[bi].text EQ urlInfo.text&gt;<br />   &lt;cfset thisPageEntryIndex = bi&gt;<br />   &lt;cfbreak&gt;<br />  &lt;/cfif&gt;<br /> &lt;/cfloop&gt;<br /><br /> &lt;!--- <br />    this does exist in the list already, so start trimming - even though<br />    I could have trimmed in the last loop, this seems cleaner and much<br />    easier to read<br /> ---&gt;<br /> &lt;cfif thisPageEntryIndex&gt;<br />  &lt;cfset breadCrumb = ArrayLeft(breadCrumb,thisPageEntryIndex)&gt;<br /> &lt;cfelse&gt;<br />  &lt;!--- new breadcrumb entry, add it to the array ---&gt;<br />  &lt;cfset ArrayAppend(breadCrumb,urlInfo)&gt;<br /> &lt;/cfif&gt;<br /><br />  &lt;!--- save our breadcrumb back to the client variable as a WDDX packet ---&gt;<br />  &lt;cfwddx action="cfml2wddx" input="#breadcrumb#" output="client.breadcrumb"&gt;<br />&lt;/cfsilent&gt;<br /><br /><br />&lt;!--- display the breadcrumb ---&gt;<br />&lt;cfoutput&gt;<br />&lt;!--- <br /> display as an ordered list - because that is what it is in reality <br /> I use some styles to hide the list "look" and make it run horizontally<br /> across the page<br />---&gt;<br />&lt;ol id="breadcrumb"&gt;<br /> &lt;cfset lastCrumb = ArrayLen(breadCrumb)&gt;<br /> &lt;cfloop from="1" to="#lastCrumb#" index="bi"&gt;<br />  &lt;cfif bi EQ lastCrumb&gt;<br />   &lt;li&gt;&lt;span&gt;#breadCrumb[bi].text#&lt;/span&gt;&lt;/li&gt;<br />  &lt;cfelse&gt;<br />   &lt;li&gt;&lt;a href="#breadCrumb[bi].link##breadCrumb[bi].args#" title="#breadCrumb[bi].text#"&gt;#breadCrumb[bi].text#&lt;/a&gt; &gt;&lt;/li&gt;<br />  &lt;/cfif&gt;<br /> &lt;/cfloop&gt;<br />&lt;/ol&gt;<br />&lt;br class="clear" /&gt;<br />&lt;h2 id="pagecaption"&gt;<br /> #attributes.pagecaption#<br />&lt;/h2&gt;<br />&lt;/cfoutput&gt;<br /></pre><br />===================================================================<br />// end dsp.breadcrumb.cfm<br />===================================================================<br /><br /><br />As always, comments and critisism is welcome. If you want to use this code - go for it. It is free to use under the GNU Public License. I have tested it fairly well and it seems to work no matter how complicated of a page your loading (ie 0 or 100 attributes required). I'd love to hear how others approach the same issue.</div>
<h2>Comments</h2>
<div class='comments'>
<div class='comment'>
<div class='author'>Noel Luneau</div>
<div class='content'>
Hi Bill,<BR/><BR/>I'm interested in this this, but like Ken, I'm lost on the application of your attributeCollection="#attributes#" and cfif attributes.page EQ homePageText.<BR/><BR/>Would you mind providing some examples from application.cfm and etc, on how you set attributes.page and attributes.<BR/><BR/>I also use index.cfm?page=somePage&someargument=SomeValue.<BR/><BR/>Thank you,<BR/><BR/>Noel Luneau</div>
</div>
<div class='comment'>
<div class='author'>Bill</div>
<div class='content'>
attributeCollection is a way to pass in all of the attributes to a custom tag in one structure (instead of passing each argument by name).<BR/><BR/>The attributes value I am passing in to attributeCollection contains all of the form and url parameters that were needed for the current page to load.</div>
</div>
<div class='comment'>
<div class='author'>Ken Gladden</div>
<div class='content'>
OK, but i still don't understand what attributeCollection = "#attributes#"  in build_url_string needs to be.<BR/><BR/>Ken</div>
</div>
<div class='comment'>
<div class='author'>Bill</div>
<div class='content'>
page is my page variable (ie when I say index.cfm?page=somePage&someargument=SomeValue)<BR/><BR/>I didn't think I had left any direct refrences to attributes.page in the code I posted - but if I did you will want to update it to be whatever you call your "page" argument.<BR/><BR/>I use a page argument because all of my pages actually are accessed via index.cfm (as opposed to having a unique .cfm address for each part of the site).<BR/><BR/>Hope that helps</div>
</div>
<div class='comment'>
<div class='author'>Ken Gladden</div>
<div class='content'>
Thanks for answering! <BR/>I'm still missing something. What do I put in my CF page? I thoguht I did a cfinclude of dsp.breadcrumb.cfm but I get an error saying that "page" is not defined in "attributes" which is this line in dsp.breadcrumb.cfm:<BR/><BR/>cfif attributes.page EQ homePageText<BR/><BR/>I thought after the include of dsp.breadcrumb.cfm I would then be able to set urlInfo values. <BR/><BR/>TIA <BR/><BR/>ken@kibbage.com</div>
</div>
<div class='comment'>
<div class='author'>Bill</div>
<div class='content'>
i pretty much turn every form and url variable I need for the current page to load properly into the attributes scope.  Then I pass that structure in to the build_url_string function.  It builds the full url that will be used as the hyperlink for the crumb in the trail.<BR/><BR/>Hope that helps.<BR/>Bill</div>
</div>
<div class='comment'>
<div class='author'>Ken Gladden</div>
<div class='content'>
This is exactly what I was loking for (can't believe it was posted over a year ago). Thank you very much. However the 'build_url_string attributeCollection="#attributes#"' doesn't appear to be documented. What should this be. <BR/>I hope you are still on this blog!</div>
</div>
</div>
