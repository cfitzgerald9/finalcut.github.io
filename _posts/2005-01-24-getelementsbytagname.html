---
layout: post
title: "getElementsByTagName"
date: 2005-01-24
comments: false
categories:
 - coldfusion
 - utilities
---

<div class='post'>
Not everything I am going to write about here is as obscure and theoretical as my prior two posts. Indeed this post, like many others, will deal with real problems I face at work and some of the ways in which I address solving thos problems. Friday, I was assigned the task of checking HTML content chunks for a distinct set of <a href="http://section508.gov/" title="Accessability Guidelines">section 508</a> problems. At first glance this might seem like a semi-complex problem. However, I have two things going for me. First, I am not required to check for html well formedness. That means if a tag is missing its closing tag, I don't need to care. Secondly, and most importantly, I only have to test for a specific subset of tags and the presence of their corresponding attributes. For example I need to make sure all image tags have an alt attribute and that all table tags have a summary attribute.<br /><br />Basically, I am looking for the same type of pattern in both of the aforementioned examples. Now, this would be super easy if ColdFusion supported DOM functions on html fragments such as getElementByTagName. Java does support this thanks to the Xerces parser and some open source libraries for html parsing. However, at this point I think invoking these java objects would be overkill. Instead, until I know even more about the problem domain, I think I can use two pretty simple functions to get all of the tags of a certain type and then to test those tags for the presence of the specified attribute.<br /><br />Here is my UDF to grab all of the elements of a tag name - named, obviously enough, getElementsByTagName<br /><pre name="code" class="coldfusion"><br />&lt;cffunction name="getElementsByTagName" returntype="array" hint="returns an array of the specified tag elements"&gt;<br /> &lt;cfargument name="html"   type="string" required="true"&gt;<br /> &lt;cfargument name="tag"   type="string" required="true"&gt;<br /><br /> &lt;cfset var startPos = 0&gt;<br /> &lt;cfset var endPos = 0&gt;<br /> &lt;cfset var count = 0&gt;<br /> &lt;cfset var findTag = "&lt;" & arguments.tag&gt;<br /> &lt;cfset var htmlString = arguments.html&gt;<br /> &lt;cfset var tagArray = ArrayNew(1)&gt;<br /><br /> &lt;cfset startPos = findNoCase(findTag,htmlString)&gt;<br /><br /> &lt;cfloop condition="startPos GT 0"&gt;<br />  &lt;cfset endPos = find("&gt;",htmlString,startpos)&gt;<br />  &lt;cfif endPos&gt;<br />   &lt;cfset count = endPos - startpos + 1&gt;<br />   &lt;cfset thisTag = Mid(htmlString,startPos,count)&gt;<br />   &lt;cfset arrayAppend(tagArray,thisTag)&gt;<br />   &lt;cfset count = Len(htmlString) - endPos&gt;<br />   &lt;cfif count&gt;<br />    &lt;cfset htmlString = Right(htmlString,count)&gt;<br />    &lt;cfset startPos = findNoCase(findTag,htmlString)&gt;<br />   &lt;cfelse&gt;<br />    &lt;cfset startPos = 0&gt;<br />   &lt;/cfif&gt;<br />  &lt;cfelse&gt;<br />   &lt;cfset startPos = 0&gt;<br />  &lt;/cfif&gt;<br /> &lt;/cfloop&gt;<br /><br /><br /> &lt;cfreturn tagArray&gt;<br /><br />&lt;/cffunction&gt;<br /></pre><br /><br />This function returns to me an array of "tags" from the opening bracket to the closing bracket. This way I am sure to have all of the attributes of the tag. So now all I need to do is loop over the array and find the elements that don't have a specific attribute. Here I make two assuptions.<br /><ol> <li>all attributes will be proceeded by at least one space</li><li>all attributes names will be followed by an equal sign (=)</li> </ol> Now, to improve this later I should probaly say an attribute name will be followed by 0 or 1 spaces and then an equal sign, or maybe even 0 or more spaces before the equal sign. However, at the moment I'm running with this very basic, and probably false assumption. Heres the UDF:<br /><pre name="code" class="coldfusion"><br />&lt;cffunction name="checkTagForAttribute" returntype="array" hint="returns an array of tags missing the specified property" access="private"&gt;<br />     &lt;cfargument name="tagArray" type="array"&gt;<br />     &lt;cfargument name="attribute" type="string"&gt;<br /><br />     &lt;cfset badarray =" ArrayNew(1)"&gt;<br />     &lt;cfset arraycount =" 1"&gt;<br />     &lt;cfset thistag = ""&gt;<br />     &lt;cfset findattribute = " #arguments.attribute#="&gt;<br />     &lt;cfloop condition="arrayCount LTE ArrayLen(arguments.tagArray)"&gt;<br />         &lt;cfset thistag =" arguments.tagArray[arrayCount]"&gt;<br />         &lt;cfif&gt;<br />             &lt;cfset&gt;<br />         &lt;/cfif&gt;<br />         &lt;cfset arraycount =" arrayCount"&gt;<br />     &lt;/cfloop&gt;<br />     &lt;cfreturn&gt;<br /> &lt;/cffunction&gt;<br /><br /></pre><br /><br />this function also returns an array - a subset of the tags but this time only those tags that fail to have the specified attribute. If the array is empty then no obvious 508 problems are present in that tag set. Now, to test an HTML code snippet I can just call these two functions back-to-back for each tag/attribute pair I need to test against. At that point I can then do a variety of things; present a list of problems or even prompt the user for fixes to each problem and then update the html snippet automatically.<br /><br />Since I have captured the entire text of each tag I can also show the entire HTML snippet and highlight the problem tags if I need to as well. While both functions could probably be improved both work against the problem domain as I currently understand it and are both easilly extensible as I understand the problem better. Oh, and I guess both could use a little bit of commenting too!</div>
<h2>Comments</h2>
<div class='comments'>
<div class='comment'>
<div class='author'>Bill</div>
<div class='content'>
The code has been fixed.  I&#39;m really not sure what happened.</div>
</div>
<div class='comment'>
<div class='author'>Bill</div>
<div class='content'>
actually all sorts of code is missing from the function.  I wonder what happened to it - and why all the quotation marks ended up in it..<br /><br />Bah.</div>
</div>
<div class='comment'>
<div class='author'>Anonymous</div>
<div class='content'>
This looks great, but there are errors &lt;cfif&gt; and &lt;cfset&gt;</div>
</div>
</div>
