---
layout: post
title: "DOM Gotchas"
date: 2006-02-14
comments: false
categories:
 - javascript
 - dom
 - ajax
---

<div class='post'>
In an effort to help others avoid the pitfalls I find I am detailing here two trouble spots I recently ran into with Internet Explorer and The DOM.<br /><br />First look at this javascript:<br /><br /><pre name="code" class="jscript"><br /> var obj = getObjectRefByID(someID);<br /> var tbl = document.createElement("table");<br /> var tr = document.createElement("tr");<br /> var td = document.createElement("td");<br /> var tn = document.createTextNode("This is a test");<br /> td.appendChild(tn);<br /> tr.appendChild(td);<br /> tbl.appendChild(tr);<br /> obj.appendChild(tbl);<br /><br />//purely for testing purposes<br />alert(obj.innerHTML);<br /><br /></pre><br /><br />Why do you think the table wouldn't appear in the webpage within the element?  It's kind of sly why it doesn't.  For further confusion add an alert(obj.innerHTML) to the end of the code.  You will see all the html needed to render the table.  What gives?<br /><br /><pre name="code" class="jscript"><br /> var obj = getObjectRefByID(someID);<strong><br /> var tbdy = document.createElement("tbody");</strong><br /> var tbl = document.createElement("table");<br /> var tr = document.createElement("tr");<br /> var td = document.createElement("td");<br /> var tn = document.createTextNode("This is a test");<br /> td.appendChild(tn);<br /> tr.appendChild(td);<br /> tbdy.appendChild(tr);<strong><br /> tbl.appendChild(tbdy);<br /> obj.appendChild(tbl);</strong><br /></pre><br /><br />You'll see I added a tbody element and now the table renders properly.  Without that IE won't display the table object I built up and inserted into the DOM.  This is a subtle addition but very important. Note: without the tbody object the table was rendered fine in Mozilla browsers.<br /><br />Interestingly, according to the <a href="http://www.w3.org/TR/html4/struct/tables.html#h-11.2.3">HTML4 standard</a> a tbody isn't required within a table:<br /><blockquote><br />Table rows may be grouped into a table head, table foot, and one or more table body sections, using the THEAD, TFOOT and TBODY elements, respectively. This division enables user agents to support scrolling of table bodies independently of the table head and foot. When long tables are printed, the table head and foot information may be repeated on each page that contains table data.<br /></blockquote><br /><br />This next one is pretty subtle too and again only occurs in Internet Explorer (as far as I know).<br /><br /><pre name="code" class="jscript"><br /> var obj = getObjectRefByID(someID);<br /> var cbx = document.createElement("checkbox");<br /> cbx.type = "checkbox";<br /> cbx.id = "myCBX";<br /> cbx.setAttribute("checked","checked");<br /> obj.appendChild(cbx);<br /><br />// for debugging purposes<br />alert(cbx.checked);<br /></pre><br /><br />You will noticed I set the checked status on the checkbox.  But when IE renders that code the checkbox is unchecked.  But when I do the alert it tells me true.  What the...?  Well, it turns out IE's rendering doesn't care what I do to the checkbox before I insert it into the document.  IE only reflects those changes made after the insertion - so the order of events has to be as follows:<br /><br /><pre name="code" class="jscript"><br /> var obj = getObjectRefByID(someID);<br /> var cbx = document.createElement("input");<br /> cbx.type = "checkbox";<br /> cbx.id = "myCBX";<br /> obj.appendChild(cbx);<br /> cbx.setAttribute("checked","checked");<br /></pre><br /><br />One more thing related to that last example.  You need to assign the type to the object before you insert it into the document or else IE will complain and show a text element instead of a checkbox.  My natural inclination was to fully prepare the object before I inserted it into the document which was almost correct except for that checked attribute.  Again, the first code sample worked flawlessly in Mozilla.<br /><br />Wierd stuff to be sure.  They are also highly annoying and can be difficult to debug since IE tells you everything you did is correct.  Hopefully these two "gotchas" won't get you!</div>
<h2>Comments</h2>
<div class='comments'>
<div class='comment'>
<div class='author'>Bill</div>
<div class='content'>
rejitha,<br /><br />No suggestions really.  I imagine there may be some security implications with inserting an iframe into a webpage dynamically since the iframe can load content from a remote site.</div>
</div>
<div class='comment'>
<div class='author'>rejitha</div>
<div class='content'>
#  td.appendChild(iframe);  //does not work.. any clues or tips..</div>
</div>
<div class='comment'>
<div class='author'>Zecc</div>
<div class='content'>
No one said it yet, but the checked/defaultChecked thing applies to radio buttons too (at least in IE6).<BR/><BR/>Edit: ok, so Pramod Biligiri did mention it. Still, I confirm.</div>
</div>
<div class='comment'>
<div class='author'>Anonymous</div>
<div class='content'>
Another way to set events effectively in IE is to do the following:<BR/><BR/>var myLink = document.createElementById("a");<BR/>myLink.onClick = "alert('test')";<BR/><BR/>document.body.appendChild(myLink);<BR/>document.body.innerHTML = document.body.innerHTML;<BR/><BR/>I suppose you could also use myLink.parentNode.innerHTMl = myLink.parentNode.innerHTML</div>
</div>
<div class='comment'>
<div class='author'>Anonymous</div>
<div class='content'>
Thank you for explaining the strange rendering behavior requiring tbody tags to be present within tables inserted via DOM nodes in IE.<BR/><BR/>You have saved me from pulling out the little remaining hair I have left.</div>
</div>
<div class='comment'>
<div class='author'>Alan</div>
<div class='content'>
Thank you. You saved much anguish!</div>
</div>
<div class='comment'>
<div class='author'>Rex</div>
<div class='content'>
As you've noticed, there are a tonne of issues with IE, and creating elements, and setting attributes, and events. (yikes!)<BR/><BR/>For some additional info on these bugs (and many others) check out this blog for tracking browser bugs.<BR/><BR/>http://webbugtrack.blogspot.com/2007/08/bug-242-setattribute-doesnt-always-work.html</div>
</div>
<div class='comment'>
<div class='author'>smileyriley</div>
<div class='content'>
Thanks so much, I tend to code for firefox first, and then look at IE issues. <BR/><BR/>Reading this post solved all issues and im now a happy chappy.<BR/><BR/>Cheers</div>
</div>
<div class='comment'>
<div class='author'>Anonymous</div>
<div class='content'>
Can I just add to what most of the others above me said..<br /><b>THANK YOU!!!</b><br />The table not displaying in IE got me for a few hours, I'm away from the machine I was coding it on, but was thinking I'd end up adding thead, tbody and tfooter and see what happened. Now I know it's going to work when I do! Yey!<br /><br />Steve Daniels</div>
</div>
<div class='comment'>
<div class='author'>Anonymous</div>
<div class='content'>
to make <br /><br />inp1[onclick] = function () {alert("hello");};<br /><br />work in the ie I had to add "<br /><br />inp1[<b>"</b>onclick<b>"</b>] = function () {alert("hello");};<br /><br />thanks though - saved me a lot of time</div>
</div>
<div class='comment'>
<div class='author'>Anonymous</div>
<div class='content'>
thank you <i>thank you</i> <b>thank you</b></div>
</div>
<div class='comment'>
<div class='author'>Anonymous</div>
<div class='content'>
Awesome!  Googled on the IE table problem.. but didn't expect to find anything.. thanks soooo much.<br />but please fix the code.. noticed the same as others.. have to add the row to the Tbody, then to the Table.</div>
</div>
<div class='comment'>
<div class='author'>Anonymous</div>
<div class='content'>
I was going thru this, Seems ok and i have done the same. For me I have added row to a table , 5 new cells and in cells select boxes are there.<br />now<br />1. rows are created.<br />2. Select box is created<br />3. methods does work on select box change.<br /><br />but when I submit the form i do not get values for newly created rows on firefox. where as in IE i do get values. suppose there were 2 rows when page was loaded now if i add 2 more... IE will show 4 as total on server side and firefoxwill still show only 2 in struts form (server side).. If i add alert before submit firefox does show 4 as total length of table... no idea what's going wrong.</div>
</div>
<div class='comment'>
<div class='author'>Anonymous</div>
<div class='content'>
i just came across a similar issue when setting col widths on the table: &lt;col width="10%"&gt; for instance. I was appending them to the table element. However, IE wont render until you have created a "colgroup" (appended to table) and append all the col elements to this. Not sure what the spec says, but Firefox didn't seem to mind either way :-)</div>
</div>
<div class='comment'>
<div class='author'>Anonymous</div>
<div class='content'>
Thank you very much!<br />I lost hours trying to get that checkbox checked.<br /><br />GhoulLord</div>
</div>
<div class='comment'>
<div class='author'>radicalbright</div>
<div class='content'>
thanks for the help.  ie resets checkboxes when they are added. why why why????  hahahaha</div>
</div>
<div class='comment'>
<div class='author'>bawb</div>
<div class='content'>
Thank you. Very helpful.</div>
</div>
<div class='comment'>
<div class='author'>Bill</div>
<div class='content'>
thanks, it is now fixed.  odd I didn't notice that before.  Thanks again!</div>
</div>
<div class='comment'>
<div class='author'>Anonymous</div>
<div class='content'>
Regarding Hemant's comment, the code in your original post is still<br /><br />var cbx = document.createElement("checkbox");<br /><br />(Might want to edit that.)</div>
</div>
<div class='comment'>
<div class='author'>Bill</div>
<div class='content'>
Feel free to post your comments here JiYung.  The conversation will be a little slow (due to comment moderation) but this is a good place to address issues with dynamic table creation.</div>
</div>
<div class='comment'>
<div class='author'>JiYung</div>
<div class='content'>
<b>yes, it did.<br />thanks bill.</b><br />i hate IE how IE is so different<br />i'm trying to build a dynamic table creater.which can contain general input elements.<br />i had encountered a lot of strang problems on making it compatible with IE.<br />some of them ware solved , some ware not. i wonder can we discuss them on this post.<br />they may make the post going to far</div>
</div>
<div class='comment'>
<div class='author'>Bill</div>
<div class='content'>
Jiyung,<br /><br />You can specify the element name as so:<br /><br />inp1.name ="list";<br /><br />that will work in opera, firefox, and ie.</div>
</div>
<div class='comment'>
<div class='author'>JiYung</div>
<div class='content'>
i finally found that change the following code:<br /><b><br />inp1.setAttribute("onclick",'alert("hello");'); </b><br /><br />to this:<br /><b>inp1[onclick] = function ()                 {alert("hello");};<br /></b><br />will work well in IE<br /><br />but i found anothor problem in IE<br />either this line<br /><b>inp1.setAttribute("name","list"); </b><br />or this line<br /><b>inp1[name]="list";</b><br />doesn't make sense to IE <br />how to specify the element's name in javascript</div>
</div>
<div class='comment'>
<div class='author'>JiYung</div>
<div class='content'>
thanks for nice guide.<br />i've tried to insert some dynamic<br />generated javascipt in dom<br />like the code shows below<br />(i simplied the problem by using a alert function)<br /><br /><br />var table1 = document.getElementById("tbody1");<br />var row = document.createElement("TR");<br />var cell1 = document.createElement("TD"); <br />var inp1 = document.createElement("INPUT"); <br />inp1.setAttribute("type","button"); <br />inp1.setAttribute("name","list");<br />inp1.setAttribute("value","hello"); <br /><b>inp1.setAttribute("onclick",'alert("hello");'); </b><br />cell1.appendChild(inp1);<br />row.appendChild(cell1);<br />table1.appendChild(row);<br /><br /><br />the code did work in firefox 1.5x and opera 8.5x.<br />but IE seams not working well.<br />how do I apply this In IE?<br />thanks for any suggestions.</div>
</div>
<div class='comment'>
<div class='author'>JiYung</div>
<div class='content'>
thanks for the nice guide.<br />i've tried to insert some dynamic<br />generated javascipt in dom<br />like the code shows below<br />(i simplied the problem by using a alert function)<br /><br /><i><br />var table1 = document.getElementById("tbody1");<br />var row = document.createElement("TR");<br />var cell1 = document.createElement("TD"); <br />var inp1 = document.createElement("INPUT"); <br />inp1.setAttribute("type","button"); <br />inp1.setAttribute("name","list");<br />inp1.setAttribute("value","hello"); <br /><b>inp1.setAttribute("onclick",'alert("hello");'); </b><br />cell1.appendChild(inp1);<br />row.appendChild(cell1);<br />table1.appendChild(row);<br /></i><br /><br />the code did work in firefox 1.5x and opera 8.5x.<br />but IE seams not working well.<br />how do I apply this In IE?<br />thanks for any suggestions.</div>
</div>
<div class='comment'>
<div class='author'>Bill</div>
<div class='content'>
good point Jeff. I never really read it that way but perhaps that is how it was meant to be read.<br /><br /><br />Thanks for the alternate way of looking at it.</div>
</div>
<div class='comment'>
<div class='author'>Jeff</div>
<div class='content'>
To be fair, the spec says "one or more" tbody elements may be used in a table.  It does not specifically say a table can be devoid of a tbody element.</div>
</div>
<div class='comment'>
<div class='author'>vsumner</div>
<div class='content'>
className is cross browser<BR/><BR/>class is not</div>
</div>
<div class='comment'>
<div class='author'>Aaron Averett</div>
<div class='content'>
Dude, you are <I>the man</I>!  I just wasted like four hours on the non-displaying-table nightmare.<BR/><BR/>You have a mistake in your example code, though.  You have to append the tbody element as a child of the table, and then append the table as a child of obj, or it still doesn't display.<BR/><BR/>It should look like this, I think.  (Changed parts are in bold)<BR/>  var obj = getObjectRefByID(someID);<BR/>  var tbdy = document.createElement("tbody"); <BR/>  var tbl = document.createElement("table");<BR/>  var tr = document.createElement("tr");<BR/>  var td = document.createElement("td");<BR/>  var tn = document.createTextNode("This is a test");<BR/>  td.appendChild(tn);<BR/>  tr.appendChild(td);<BR/>  tbdy.appendChild(tr);<BR/>  <B>tbl.appendChild(tbdy);</B><BR/>  obj.appendChild(<B>tbl</B>);</div>
</div>
<div class='comment'>
<div class='author'>Ahmader</div>
<div class='content'>
Bill, man million of thanks i was not only pulling my hair out but i was going to cut my self body aparts this DOM is getting me crazy specialy making it working for both Mozilla and IE.<BR/><BR/>one more tip FLOAT guyz any one had trouble with them !!<BR/><BR/>IE only accept<BR/>obj.style.styleFloat<BR/><BR/>and mozilla<BR/>obj.style.cssFloat <BR/><BR/>I dont know why desktop developers just hate web developers I am spending days to find out bug or stuff that for no sence. Thanks millions again</div>
</div>
<div class='comment'>
<div class='author'>Anonymous</div>
<div class='content'>
That checkbox thing (IE resets the value of "checked" upon insertion) is incredibly annoying.  Of course, if you're building a large-ish amount of HTML using DOM methods, setting it after insertion might be a cumbersome hack... one way to work around it in IE is to set the "defaultChecked" property; IE will honor this after insertion and set the checked property correctly.</div>
</div>
<div class='comment'>
<div class='author'>Anonymous</div>
<div class='content'>
thanks a lot man !! i was getting crazy trying to display dynamic tables.</div>
</div>
<div class='comment'>
<div class='author'>Anonymous</div>
<div class='content'>
Thanks alot. Wasted 4 hours trying to get the dynamic rows to show up in IE.</div>
</div>
<div class='comment'>
<div class='author'>Anonymous</div>
<div class='content'>
The TBODY stuff has also to be considered when adding rows to an existing table. Rather than appending it to the table itself ist has to be appended to the table's firstChild (which is in fact the TBODY).<BR/><BR/>Thanks for the tip.</div>
</div>
<div class='comment'>
<div class='author'>Anonymous</div>
<div class='content'>
Thanks man, I was looking for this information:<BR/><BR/>'You need to assign the type to the object before you insert it into the document or else IE will complain and show a text element instead of a checkbox.'<BR/><BR/>Many many thanks! :)</div>
</div>
<div class='comment'>
<div class='author'>Bill</div>
<div class='content'>
Thanks Pramod for the tip</div>
</div>
<div class='comment'>
<div class='author'>Pramod Biligiri</div>
<div class='content'>
I just wasted some time on the same problem. <BR/>I found you can use the "defaultChecked" attribute to check checkboxes and radio buttons. This works even when the created DOM node is free-standing and not yet appended to the DOM.<BR/>Eg: node.defaultChecked = true;<BR/><BR/>See http://channel9.msdn.com/wiki/default.aspx/Channel9.InternetExplorerProgrammingBugs<BR/>and http://www.w3.org/TR/DOM-Level-2-HTML/html.html#ID-20509171</div>
</div>
<div class='comment'>
<div class='author'>Bill</div>
<div class='content'>
I am not sure how your attempting to set the attributes. Typically there are two ways - directly or by using the setAttribute method of the object.<BR/><BR/>For instance if you want to set a tds class you can do this:<BR/><BR/>...<BR/>myTd = document.createElement('td');<BR/>myTableRow.appendChild(myTd);<BR/>myTd.className = 'someClassName'<BR/><BR/>OR<BR/>...<BR/>myTd = document.createElement('td');<BR/>myTableRow.appendChild(myTd);<BR/>myTd.setAttribute("class","someClassName");<BR/>myTd.setAttribute("className","someClassName");<BR/><BR/><BR/>In my second example I set both the class and className attribute simply because I can't remember which one works in both browsers. (but one of them does).</div>
</div>
<div class='comment'>
<div class='author'>Rob Welbourn</div>
<div class='content'>
I, too, was pulling my hair out over the TBODY issue in IE -- thanks for the tip.  Alas, IE stubbornly refuses to act on attribute settings to elements within the table, even when I set them after the table has been inserted into the document.  With Firefox, setting the attributes either before or after the elements have been inserted works just fine.<BR/><BR/>In my case, I'm attempting to apply formatting to my table TDs by means of classes linked to a stylesheet, and to set an 'onclick' handler for each of the TDs.<BR/><BR/>Any thoughts on this issue?<BR/><BR/>Rob</div>
</div>
<div class='comment'>
<div class='author'>Bill</div>
<div class='content'>
yes I have an idea.<BR/><BR/>You should change your function like so:<BR/><BR/>var cbx = document.createElement("checkbox");<BR/><BR/>to<BR/><BR/>var cbx = document.createElement("input");<BR/><BR/>you are creating an input element and then making it of type "checkbox" you have the type setting correct - but the object creation incorrect.</div>
</div>
<div class='comment'>
<div class='author'>Hemant</div>
<div class='content'>
Hi followed your suggestions to create checkboxs as follows<BR/><BR/>function createCheckBox(NODE, id, value) {<BR/>    var cbx =   document.createElement("checkbox");<BR/>    cbx.type = "checkbox";<BR/>    cbx.id = id;<BR/>    cbx.value = value;<BR/>    NODE.appendChild(cbx);<BR/>}<BR/><BR/>but still get a text element instead of a checkbox. <BR/><BR/>any ideas?</div>
</div>
<div class='comment'>
<div class='author'>Bill</div>
<div class='content'>
no problemo - that's why I posted it so other's wouldn't have to go as crazy as I did :O)</div>
</div>
<div class='comment'>
<div class='author'>Jack Killpatrick</div>
<div class='content'>
It ended up being something about the browser session I was still in. I probably messed with things so much during dev that the browser was a bit freaked out. When I closed all browser instances and restarted the browser that issue went away. Whew~!<BR/><BR/>Thanks again for the TBODY tip, that was making me nuts!</div>
</div>
<div class='comment'>
<div class='author'>Bill</div>
<div class='content'>
off the top of my head no.  I vaguely remember encountering this before though.<BR/><BR/>the only way I could probably answer it is to look at the problem again and to tool around with the code to try and get something to happen.</div>
</div>
<div class='comment'>
<div class='author'>Jack Killpatrick</div>
<div class='content'>
Thanks for the info about IE and TBODY, I was pulling my hair out trying to figure out why my dynamically created table rows would not display in IE, even though the innerHTML necessary was present.<BR/><BR/>However, I have another related problem... maybe you know the answer to? When the table displays, IE only displays the parts of the table that exist inside the viewport of the browser, not the right-hand scrollbar nor rows that are partially "below" the viewport. Only if I resize the browser will the right-hand scrollbar and the rest of the table appear. Any suggestions? In Firefox 1.5 it all works fine.</div>
</div>
</div>
