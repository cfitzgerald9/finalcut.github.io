---
layout: post
title: "RegEx Gotcha to Avoid"
date: 2005-05-18
comments: false
categories:
 - phone number
 - regular expression
 - regex
---

<div class='post'>
Last week I posted about <a href="http://cf-bill.blogspot.com/2005/05/great-javascript-form-validation.html">a great javascript validation library</a>. However, prior to even knowing about it I had often used javascript regular expressions to validate form data for format before passing it on. One of my regular expressions was designed to test for the proper formatting of phone numbers and it was almost perfect for my needs.<br /><br />Well, except for one major bug that let pretty much any garbage pass.<br /><br />Now, I also tested somewhat on the serverside as well so it hand't really caused me a data problem but the possibility was there. The funny thing is this regEx and so many others like it on the net have been in use for years and almost all that I have seen have the same problem.<br /><br />I know alot of them do because when I first needed one I found it on the net (before I knew anything at all about how to build my own regEx). Then later when I needed it to be more capable I found others and snipped clipped and pasted together many to get the one I needed. All of them have the same problem though and that is they let arbitrary characters in at the beginning of the string.<br /><br />So, if your regex is supposed to limit to a number format of xxx-xxx-xxxx where the area code is optional and you write:<br /><span style="color: rgb(51, 102, 255);">(\d{3})?\d{3}\-\d{4}$</span><br /><br />You might think you're ok.  But, you're not.  Sure, this will stop you from doing some things but it isn't foolproof.<br /><br />you need to change it to:<br /><span style="color: rgb(51, 102, 255);"><span style="color: rgb(255, 102, 102);">^</span>(\d{3})?\d{3}\-\d{4}$<br /><span style="color: rgb(0, 0, 0);"><br />Notice, I added the <span style="color: rgb(255, 0, 0);">^</span> which means "match start of string" Without that you can enter pretty much whatever you want before your valid phone number pattern and still get it to pass the validation routine that should have cut it out. Note also that you can't use the optional <span style="color: rgb(255, 102, 102);">\A</span> regEx anchor instead of the <span style="color: rgb(255, 102, 102);">^</span> as it will not work.  That little caveat caused me some issues.<br /><br />So instead of only allowing:<br />304-525-5555 or<br />525-5555<br />it also allows:<br />falsdfjoij304-525-5555<br />fjsadkqlfjdsa525-5555<br /><br />not really what you want is it? Anyway, here is my final regular expression for phone number validation. I did this a bit differently than I normally would so I could really explain each part of the regEx. Normally I would just build the regEX and be done with it.<br /></span></span><br /><pre name="code" class="jscript"><br />function isValidPhoneNumber(s){<br /> var pat = "^";<br /> var exp;<br />  // BEGIN THE ARA CODE GROUPING<br />  pat = pat + "(";<br />   // OPTIONAL OPENING (<br />   pat = pat + "\\(?";<br />   // 3 DIGIT AREA CODE<br />   pat = pat + "\\d{3}";<br />   // OPTIONAL CLOSING )<br />   pat = pat + "\\)?";<br />   // OPTIONAL DASH OR SPACE BETWEEN AREA CODE AND PREFIX<br />   pat = pat + "(\\-| )?";<br />  // END THE AREA CODE GROUPING<br />  pat = pat + ")?";<br /> // PREFIX<br /> pat = pat + "\\d{3}";<br /> //OPTIONAL DASH OR SPACE BETWEEN PREFIX AND SUFFIX<br /> pat = pat + "(\\-| )?";<br /> // SUFFIX<br /> pat = pat + "\\d{4}";<br /> // OPTIONAL SPACE<br /> pat = pat + "\\s?";<br /> // OPTIONAL EXTENSION ID - xt, ext, x, space, or dash<br /> pat = pat + "(\\-|x|X|ext|EXT|ex|EX| )?";<br /> // OPTIONAL SPACE<br /> pat = pat + "\\s?";<br /> // OPTIONAL EXTENSION UP TO 6 NUMBERS<br /> pat = pat + "\\d{0,6}?";<br /> // END OF INPUT<br /> pat = pat + "$";<br /> exp = new RegExp(pat);<br /> return exp.test(s);<br />}<br /></pre></div>
<h2>Comments</h2>
<div class='comments'>
<div class='comment'>
<div class='author'>Bill</div>
<div class='content'>
Thanks,  while I am definatly not a master of them I am pretty comfortable - however I will take your advice to heart and not be very trusting of others RegExs.  <BR/><BR/>I guess that was the point of my post in some ways.  Nearly every phone number validation RegEx I found online (i even searched for more again yesterday while posting this) have the same problem of the missing ^ (match start of string).<BR/><BR/>The phone number regex I was using has been in place for quite a while and it never revealed its problem until this week when a user tried to put a / in between the areacode and phone number prefix - and it was accepted.<BR/><BR/>I'll give the book you suggested a look.  I have also thought of getting Forta's (RegEx's in Ten Minutes) just as a handy desk reference.<BR/><BR/>I think this would be a good place for a javascript unit test library.</div>
</div>
<div class='comment'>
<div class='author'>gus</div>
<div class='content'>
Regular Expressions can be daunting to learn, but are well worth the effort.  Without a solid understanding of regular expressions you should be very skeptical of any regex you find online.<BR/><BR/>My general rule of thumb with any code I find online is... if I don't understand it, I don't use it.<BR/><BR/>I highly recommend the O'Reilly book "Mastering Regular Expressions".  It's not an easy read, but well worth the effort.</div>
</div>
</div>
